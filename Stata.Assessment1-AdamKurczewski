********************************************************************
* GPRL Stat Assesmment - Adam Kurczewski: 12/28/19
********************************************************************

***************
** Data Load **
***************
clear

cd "C:\Users\kurczew2\Desktop\GPRL"

/*
Still familiarizing myself with the application of Github
but if I was more comfrotable the current directory would be set
to a github repository with the necessary data sets in it.
Ideally all pathways would be non-specific, but for now it is
necessary to alter unique pathways to match individual machines
*/

*New Variables import
import delim "C:\Users\kurczew2\Desktop\GPRL\Data\Part 1\New Variables.csv"

/*
need to make assumptions to decide which variables to merge the datasets by, as the new variables have no HHID.
investigating the main dataset (below), it appears that the new variables dataset contains "baseline" data for 
many of the obs in the main dataset.  we can partially verify this by comparing the age and educations of
observations in both, using 'uniqueid' as the key.  age and educ make good comparison variables as they are
expected to only change by 1 each year (here we assume that time between baseline and endline is 1, however we can 
calculate time between baseline and endline by checking if the age and educ of ALL uniqueids in both datasets change 
by the same amount).  It appears that using uniqueid is a good key to merge on, as both education and age are consistent (or change
by 1) for each uniqueid.
*/

* use "C:\Users\kurczew2\Desktop\GPRL\Data\Part 1\Main Dataset.dta"

*join to retain all observations, including those with no data for new variables
joinby uniqueid using "C:\Users\kurczew2\Desktop\GPRL\Data\Part 1\Main Dataset.dta", unmatched(both)

* inspect new obs dataset for any potential merging issues
* use "C:\Users\kurczew2\Desktop\GPRL\Data\Part 1\New Observations.dta"

append using "C:\Users\kurczew2\Desktop\GPRL\Data\Part 1\New Observations.dta"



*******************
** Quality Check **
*******************

* summary statsics of survey length for completed surveys
* entire sample and for each enumerator

sum surveytime if survey_complete == 1, d
 
 /*
 Median: 7165 seconds
 Mean: 7202 seconds
 Note: 
 tab survey_complete reveals
 101 surveys recorded as 'not complete'
 */

/*
By preseting survey times for all surveys, we cannot get an idea of which enunerators are
administering the survey the fastest/slowest.  This information might be useful if we suspect
data quality is affected by time spent on the survey or if hitting sample size targets is becoming a concern.
*/

 bysort surveyor: summarize surveytime if survey_complete == 1
 
* make data browsing easier to check duplicate types by sorting by hhid
sort hhid
duplicates l hhid

/*
3 hhids are duplicated (6 total duplicated obs)
Becuase so few duplicates exist it is possible to manually check
the observations to see if they are copies of the same observations or if they are incorrectly entered HHIDs.
Copies can be identified if infortmation recorded for each obs is identical or similar across enough key variables to 
warrent a determination by the analyst as the same observation entered twice (or on two separate occassions unintentionally).
To do so we can use identifiers such as age at base, age at end, education, occupation, address, or other identifiers
that can not be reasonably expected to change drastically over time.  

Using this method, I was able to identify two of the 3 obs as copies, while 1 is two seperate obs with a mismatched hhid.
usng age is not feasible here because of data entry differences (birthyear vs age).  If I new the survey year I could recode
but to avoid making any additional assumptions I will use education instead.
*/


sort hhid educ sex
quietly by hhid educ sex : gen dup = cond(_N==1, 0, _n)
drop if dup>1


**************
** Cleaning **
**************

* typically 'encode surveyor, g(surveyorid)' would quickly
* produce what we need but becuase privacy is we will manually 
* encode them as numbers to avoid any instance of the value label
* ie surveyors name being retained

gen surveyorid = 0
replace surveyroid = 1 if surveyor == "Anna"


